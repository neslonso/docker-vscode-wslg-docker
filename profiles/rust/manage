#!/bin/bash
# Script de gestión de infraestructura para perfil Rust

SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
WORKSPACE_DIR="/workspace"

# Exportar variables para docker-compose
export WORKSPACE_DIR
export COMPOSE_PROJECT_NAME="${COMPOSE_PROJECT_NAME:-rust}"

show_help() {
    echo "Gestión de infraestructura Rust"
    echo ""
    echo "Uso: $0 {start|stop|restart|logs|shell|status}"
    echo ""
    echo "Comandos disponibles:"
    echo "  start    - Levantar contenedor Rust"
    echo "  stop     - Detener contenedor Rust"
    echo "  restart  - Reiniciar contenedor Rust"
    echo "  logs     - Ver logs del contenedor"
    echo "  shell    - Abrir shell en el contenedor Rust"
    echo "  status   - Ver estado del contenedor"
    echo ""
}

case "$1" in
    start)
        bash "$SCRIPT_DIR/scripts/start.sh"
        ;;
    stop)
        bash "$SCRIPT_DIR/scripts/stop.sh"
        ;;
    restart)
        bash "$SCRIPT_DIR/scripts/stop.sh"
        sleep 2
        bash "$SCRIPT_DIR/scripts/start.sh"
        ;;
    logs)
        bash "$SCRIPT_DIR/scripts/logs.sh"
        ;;
    shell)
        bash "$SCRIPT_DIR/scripts/shell.sh"
        ;;
    status)
        docker-compose -f "$SCRIPT_DIR/docker-compose.yml" ps
        ;;
    *)
        show_help
        exit 1
        ;;
esac
