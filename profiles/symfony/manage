#!/bin/bash
# Script de gestión de infraestructura para perfil Symfony

SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
WORKSPACE_DIR="/workspace"

# Exportar variables para docker-compose
export WORKSPACE_DIR
export COMPOSE_PROJECT_NAME="${COMPOSE_PROJECT_NAME:-symfony}"

show_help() {
    echo "Gestión de infraestructura Symfony"
    echo ""
    echo "Uso: $0 {start|stop|restart|logs|status}"
    echo ""
    echo "Comandos disponibles:"
    echo "  start    - Levantar servicios de infraestructura (PHP, MySQL, Redis)"
    echo "  stop     - Detener todos los servicios"
    echo "  restart  - Reiniciar todos los servicios"
    echo "  logs     - Ver logs de los servicios"
    echo "  status   - Ver estado de los servicios"
    echo ""
}

case "$1" in
    start)
        bash "$SCRIPT_DIR/scripts/start.sh"
        ;;
    stop)
        bash "$SCRIPT_DIR/scripts/stop.sh"
        ;;
    restart)
        bash "$SCRIPT_DIR/scripts/stop.sh"
        sleep 2
        bash "$SCRIPT_DIR/scripts/start.sh"
        ;;
    logs)
        bash "$SCRIPT_DIR/scripts/logs.sh"
        ;;
    status)
        docker-compose -f "$SCRIPT_DIR/docker-compose.yml" ps
        ;;
    *)
        show_help
        exit 1
        ;;
esac
